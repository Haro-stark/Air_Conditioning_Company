<div class="text-center m-3" *ngIf="!showAddBudgetForm && !showEditBudgetForm">
  <button class="btn badge-success" (click)="onClickToggleAddBudgetForm()">
    Create New Budget
  </button>
</div>

<p *ngIf="errorMessage && errorMessage.trim().length > 0" class="alert-danger">
  {{ errorMessage }}
</p>

<div *ngIf="!showAddBudgetForm && !showEditBudgetForm">
  <div class="table-responsive">
    <table class="table">
      <ng-container *ngIf="budgets">
        <thead>
          <tr>
            <th scope="col">BudgetNumber</th>
            <th scope="col">BudgetName</th>
            <th scope="col">Total Price</th>
            <th scope="col">BudgetStatus</th>
            <th scope="col">Customer Name</th>
            <th scope="col">Report(pdf)</th>
            <th scope="col">Edit/Delete</th>
          </tr>
        </thead>
        <tbody *ngFor="let budget of budgets">
          <tr>
            <td>{{ budget.budgetId }}</td>
            <td>{{ budget.name }}</td>
            <td>{{ budget.totalPrice }}</td>
            <td>{{ budget.budgetStatus }}</td>
            <td>
              <a [routerLink]="['/customer', budget.budgetId]"> Customers</a>
            </td>
            <td>
              <button
                class="btn btn-sm badge-secondary"
                (click)="budgetPdfDownload(budget.budgetId, budget)"
              >
                Download
              </button>
            </td>
            <td>
              <fa-icon
                [icon]="editIcon"
                title="Edit"
                (click)="onEditBudget(budget.budgetId, budget)"
                [ngClass]="'edit-icon icon-button-properties mr-1'"
              ></fa-icon>
              <fa-icon
                [icon]="deleteIcon"
                title="Delete"
                (click)="onDeleteBudget(budget.budgetId, budget)"
                [ngClass]="'delete-icon icon-button-properties'"
              >
              </fa-icon>
            </td>
          </tr>
        </tbody>
      </ng-container>
    </table>
    <ng-container *ngIf="!budgets || !budgets.length">
      <div class="emptyBudget alert-warning text-center">
        There are no budgets available at this moment
      </div>
    </ng-container>
  </div>
  <router-outlet></router-outlet>
</div>

<ng-container *ngIf="showAddBudgetForm && !showEditBudgetForm">
  <h1 style="color: rgb(184, 15, 199)" class="mb-3">Add a new budget</h1>

  <form
    #inputForm="ngForm"
    (ngSubmit)="onSubmit(); formSubmitted ? inputForm.reset() : ''"
    class="form"
    name="budgetForm"
  >
    <div class="form-group">
      <label for="text" class="form-label">Budget Name</label>
      <input
        required
        id="budgetName"
        type="text"
        name="budgetName"
        placeholder="enter budget name"
        [(ngModel)]="newBudget.name"
        class="form-control"
      />
    </div>
    <div class="form-group">
      <label for="customer">Customer</label>
      <select
        class="form-select form-control"
        name="customer"
        id="customer"
        [(ngModel)]="customerName"
      >
        <option ngValue="{{ customerName }} ">New Customer</option>

        <option
          *ngFor="let customer of customers"
          ngValue="{{ customer.name }}"
        >
          {{ customer.name }}
        </option>
      </select>
    </div>
    <div class="form-group">
      <label for="services">Services</label>
      <select
        class="form-select form-control"
        name="services"
        id="services"
        [(ngModel)]="services"
        [multiple]="true"
        (ngModelChange)="isInstallationSelected(services)"
      >
        <option ngValue="installation">installation</option>
        <option ngValue="maintenance">maintenance</option>
        <option ngValue="labour">labour</option>
      </select>
    </div>
    <ng-container *ngIf="showProducts">
      <div class="form-group">
        <label for="services">products</label>
        <select
          class="form-select form-control"
          name="services"
          id="services"
          [(ngModel)]="newBudget.productList"
          [multiple]="true"
        >
          <option *ngFor="let product of products" [ngValue]="product">
            {{ product.name }}
          </option>
        </select>
      </div>
    </ng-container>

    <ng-container *ngIf="showHoursInput">
      <div class="form-group">
        <label for="officerHours" class="form-label">Officer Hours</label>
        <input
          required
          id="officerHours"
          type="number"
          name="officerHours"
          [(ngModel)]="officerHours"
          class="form-control"
        />
      </div>

      <div class="form-group">
        <label for="assistantHours" class="form-label">Assistant Hours</label>
        <input
          required
          id="assistantHours"
          type="number"
          name="assistantHours"
          [(ngModel)]="assistantHours"
          class="form-control"
        />
      </div>
    </ng-container>

    <div class="form-group">
      <label for="totalPrice" class="form-label">Total Price</label>
      <input
        disabled
        readonly
        required
        id="totalPrice"
        type="number"
        name="totalPrice"
        [(ngModel)]="newBudget.totalPrice"
        class="form-control"
      />
    </div>

    <span class="d-flex">
      <button class="btn btn-outline-success" type="submit">Save</button>

      <button
        class="btn btn-danger ml-auto"
        type="button"
        (click)="onClickToggleAddBudgetForm()"
      >
        Cancel
      </button>
    </span>
  </form>
</ng-container>
<ng-container *ngIf="showEditBudgetForm && !showAddBudgetForm">
  <h1 style="color: greenyellow" class="mb-3">Editing a budget</h1>

  <hr />
  <form
    #inputForm="ngForm"
    (ngSubmit)="onUpdateBudget(updatedBudget)"
    class="form"
    name="budgetForm"
  >
    <div class="form-group">
      <label for="text" class="form-label">Budget Name</label>
      <input
        required
        id="budgetName"
        type="text"
        name="budgetName"
        placeholder="enter budget name"
        [(ngModel)]="updatedBudget.name"
        class="form-control"
      />
    </div>
    <div class="form-group">
      <label for="customer">Customer</label>
      <select
        class="form-select form-control"
        name="customer"
        id="customer"
        [(ngModel)]="updatedBudget.customer.name"
      >
        <option ngValue="{{ customerName }} ">New Customer</option>

        <option
          *ngFor="let customer of customers"
          ngValue="{{ customer.name }}"
        >
          {{ customer.name }}
        </option>
      </select>
    </div>

    <div class="form-group">
      <label for="budgetStatus">Budget Status</label>
      <select
        class="form-select form-control"
        name="budgetStatus"
        id="budgetStatus"
        [(ngModel)]="updatedBudget.budgetStatus"
      >
        <option ngValue="Accepted ">Accepted</option>
        <option ngValue="pendingAcceptance ">PendingAcceptance</option>
        <option ngValue="Canceled ">Canceled</option>
      </select>
    </div>

    <div class="form-group">
      <label for="text" class="form-label">Total Price</label>
      <input
        required
        id="totalPrice"
        type="text"
        name="totalPrice"
        placeholder="enter budget price"
        [(ngModel)]="updatedBudget.totalPrice"
        class="form-control"
      />
    </div>

    <span class="d-flex">
      <button class="btn btn-outline-success" type="submit">Save</button>

      <button
        class="btn btn-danger ml-auto"
        type="button"
        (click)="onClickToggleEditBudgetForm()"
      >
        Cancel
      </button>
    </span>
  </form>
</ng-container>

